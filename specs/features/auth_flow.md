# 特徴仕様: 認証とプロフィール自動作成フロー

## 概要
Supabase Auth を使用した認証と、ユーザーが初めてログインした際にプロフィール (`profiles` テーブル) を自動的に初期化する仕組みを定義します。

## 認証フロー
1. **サインアップ**: 
   - ユーザーはメールアドレスとパスワードを入力。
   - Supabase Auth から確認メールが送信される。
2. **メール確認**: 
   - ユーザーがリンクをクリックすると `/auth/callback` へリダイレクト。
   - サーバーサイドでセッションを確立し、Cookie を設定。

## プロフィール自動作成 (冪等性の確保)
既存の実装では以下の2段構えでプロフィールの存在を保証しています。

1. **DB レベル (トリガー)**:
   - `auth.users` に新規行が挿入された際、`public.profiles` に基本情報を挿入する PostgreSQL トリガー。
2. **アプリレベル (フォールバック)**:
   - アイテム追加時などのサーバーアクション実行時にプロフィールが存在しない場合、その場で作成を試みる。
   - 表示名が未設定の場合は、メールアドレスのローカルパート（`@`より前）をデフォルト値とする。

## 技術的詳細
- クライアント: `@supabase/ssr` を使用。
- 管理: `utils/supabase/server.ts` で SSR 用クライアントを一括管理。
